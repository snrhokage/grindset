**rtk query / react-query**

**React** **Query** - **это** библиотека для получения, кеширования, синхронизации и обновления состояния хранящегося на сервере.


Преимущества:
1. запросы делаются с помощью хуков **useQuery** и **useMutation**, меньше бойлерплейт кода;

2. **Кеширование данных** - при выполнении запросов к серверу библиотека автоматически кэширует полученные данные. Это позволяет избежать повторных запросов на сервер при обращении к тем же данным в разных частях приложения.

3. есть **инвалидация кеша** и запросов, с помощью invalidateQueries и тэгов;

4. есть **оптимистичные обновления** состояний (optimisticUpdates)

5. удобно работать с состоянием загрузки и ошибками, так как хуки возвращают **isLoading**, **error**, то есть не нужно создавать отдельные стейты для ошибок и статуса загрузки;



**Optimistic** **updates** - это концепция, при которой мы сразу обновляем кэшированные данные, или стейт приложения и интерфейс, еще до того, как запрос на сервер будет завершен. Благодаря этому пользователь видит обновления сразу, не дожидаясь ответа от сервера.


**Инвалидация** – актуализация данных запроса, например вызываем мутацию на добавление элемента в список, и нам нужно чтобы query на получение списка перезапросил данные. Обычно это реализуется с помощью ключей (просто строки - [‘todos’, ‘items’]). В react-query чтобы инвалидировать кеш, вызываем:

queryClient`.`invalidateQueries`(“``items``”)`



**useQuery** - используется для выполнения запросов на получение данных (GET)

**useMutation** — для выполнения запросов на изменение данных (например, создание, обновление или удаление, то есть PUT, PATCH, DELETE, POST).


**Как работает кеширование в React Query?**

React Query автоматически кеширует данные на основе ключей запросов. Когда запрос выполняется впервые, данные кешируются, и при последующих вызовах с тем же ключом данные берутся из кеша, если они актуальны. Кеширование можно настроить с помощью опций, таких как **staleTime** и **cacheTime**

staleTime — Время, по истечении которого, данные считаются устаревшими. Устаревшие данные перезапрашиваются автоматически при монтировании компонента


Пример использования хуков и реализация инвалидации кеша
![[Pasted image 20240728095638.png]]