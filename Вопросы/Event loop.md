---
tags:
  - javascript
  - browser
links:
  - https://learn.javascript.ru/event-loop
  - https://youtu.be/zDlg64fsQow?si=Q_qWBW4roJW7uElG
---
==**EventLoop** - отдельный от javascript механизм который позволяет использовать неблокирующую модель ввода-вывода==

JS это **однопоточный** язык для предотвращения блокировок связанных с каими-то событиями или обращениями на сервер была введена ассинхронность. 

**Движок JavaScript**
- ﻿﻿V8 (chrome)
- ﻿﻿JavaScriptCore (safari)
- ﻿﻿Chakra (microsoft edge)
- ﻿﻿SpiderMonkey (mozilla)
**Что решает?**
- ﻿﻿Куча (heap) и стек вызовов (call stack)
- ﻿﻿Работа с памятью (выделение и сбор мусора)
- ﻿﻿Компиляция JS B машинный код
- ﻿﻿Оптимизация (кеши, скрытые классы и прочее)

EventLoop - **не является частью движков**, таких как V8
EventLoop **предоставляется СРЕДОЙ** Например браузер или node js

![[Pasted image 20240310141628.png]]

![[Pasted image 20240310141646.png]]
![[Pasted image 20240310141721.png]]
Jake Archibald JSConf
![[Pasted image 20240310141808.png]]

Ассинхронность достигается web api средствами браузера.

Евент луп это бесконечный цикл.

При вызове все функции попадают в стек вызовов если функции используют ассинхронность они попадают в web api, если нет - выполняются. После обработки web api функции попадают(калбеки) в очередь задач если стек вызовов пуст из очериди задач они попадают в стек вызовов и уже завершаются. Сама очередь делится на очериди микро задач и макро задач микро задачи имеют приоритете над макро. Микро это промисы и функции вызыванные с помощью queueMicrotask()

1. Выбрать и исполнить старейшую задачу из очереди _макрозадач_ (например, «script»).
2. Исполнить все [[Microtasks|микрозадачи]]:
    - Пока очередь микрозадач не пуста: - Выбрать из очереди и исполнить старейшую микрозадачу
3. Отрисовать изменения страницы, если они есть.
4. Если очередь макрозадач пуста – подождать, пока появится макрозадача.
5. Перейти к шагу 1.

```js
console.log(1);  

setTimeout(() => console.log(2));  

Promise.resolve().then(() => console.log(3));  

Promise.resolve().then(() => setTimeout(() => console.log(4)));  

Promise.resolve().then(() => console.log(5));  

setTimeout(() => console.log(6));  

console.log(7);

// Вывод в консоли: 1 7 3 5 2 6 4.
```